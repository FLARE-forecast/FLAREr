<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Forecasting Lake and Reservoir Ecosystems in R • FLAREr</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Forecasting Lake and Reservoir Ecosystems in R">
<meta name="description" content="This package uses the Ensemble Kalman Filter (EnKF) or the Particle Filter to assimilate observations and generate forecasts of lake water quality using the General Lake Model - Aquatic Ecosystem Dynamics. The package includes functions to generate the weather and inflow forcing files, organize observations in the form required by the data assimilation, and visualize output.">
<meta property="og:description" content="This package uses the Ensemble Kalman Filter (EnKF) or the Particle Filter to assimilate observations and generate forecasts of lake water quality using the General Lake Model - Aquatic Ecosystem Dynamics. The package includes functions to generate the weather and inflow forcing files, organize observations in the form required by the data assimilation, and visualize output.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">FLAREr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/flare-config-vignette.html">FLAREr configurations</a></li>
    <li><a class="dropdown-item" href="articles/flare-example-vignette.html">FLAREr example</a></li>
    <li><a class="dropdown-item" href="articles/flare-upgrade-vignette.html">FLAREr upgrade</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="flarer">FLAREr<a class="anchor" aria-label="anchor" href="#flarer"></a>
</h1></div>
<p>This document serves as a users guide and a tutorial for the FLARE (Forecasting Lake and Reservoir Ecosystems) system (<a href="https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/2019WR026138" class="external-link">Thomas et al. 2020</a>). FLARE generates forecasts and forecast uncertainty of water temperature and water quality for 1 to 35-day ahead time horizon at multiple depths of a lake or reservoir. It uses data assimilation to update the initial starting point for a forecast and the model parameters based a real-time statistical comparisons to observations. It has been developed, tested, and evaluated for Falling Creek Reservoir in Virginia (<a href="https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/2019WR026138" class="external-link">Thomas et al. 2020</a>), Beaverdam Reservoir in Virginia (<a href="https://doi.org/10.1002/ecs2.4752" class="external-link">Wander et al 2024</a>), Lake Sunapee in New Hampshire (<a href="http://dx.doi.org/10.2139/ssrn.4699835" class="external-link">Woelmer et al. 2024</a>) and National Ecological Observatory Network lakes across the United States (<a href="https://doi.org/10.1002/fee.2623" class="external-link">Thomas et al. 2023</a>).</p>
<p>FLAREr is a set of R scripts that</p>
<ul>
<li>Generating the inputs and configuration files required by the General Lake Model (GLM)</li>
<li>Applying data assimilation to GLM</li>
<li>Processing and archiving forecast output</li>
<li>Visualizing forecast output</li>
</ul>
<p>FLARE uses the 1-D General Lake Model (<a href="https://www.geosci-model-dev.net/12/473/2019/" class="external-link">Hipsey et al. 2019</a>) as the mechanistic process model that predicts hydrodynamics of the lake or reservoir. For forecasts of water quality, it uses GLM with the Aquatic Ecosystem Dynamics library. The binaries for GLM and GLM-AED are included in the FLARE code that is available on GitHub. FLARE requires GLM version 3.3 or higher.</p>
<p>More information about the GLM can be found here:</p>
<ul>
<li><a href="https://www.geosci-model-dev.net/12/473/2019/" class="external-link">GLM 3.0.0 manuscript</a></li>
<li><a href="https://github.com/AquaticEcoDynamics/glm-aed" class="external-link">GLM on GitHub</a></li>
<li><a href="https://aquaticecodynamics.github.io/glm-workbook/" class="external-link">GLM users guide</a></li>
</ul>
<p>FLARE development has been supported by grants from the U.S. National Science Foundation (CNS-1737424, DBI-1933016, DBI-1933102)</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You will need to download the necessary packages prior to running.</p>
<pre><code><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"FLARE-forecast/FLAREr"</span><span class="op">)</span></span></code></pre>
<p>Next you need the GLM model. You can get in using multiple pathways</p>
<p>The easiest way is to install the <code>GLM3r</code> package from Github using</p>
<pre><code><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"rqthomas/GLM3r"</span><span class="op">)</span></span></code></pre>
<p>or you can download from the AquaticEcoDynamics GitHub organization. This code assumes you are in the directory with the FLARE configurations and workflow subdirectories</p>
<pre><code><span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"https://github.com/rqthomas/glm-aed/archive/refs/heads/main.zip"</span>, <span class="st">"glm_aed.zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="st">"glm_aed.zip"</span><span class="op">)</span></span></code></pre>
<p>if you are running on Mac you will need to run:</p>
<pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/system2.html" class="external-link">system2</a></span><span class="op">(</span><span class="st">"chmod"</span>,<span class="st">"u+x glm-aed-main/binaries/macos/Sonoma/glm_latest/glm"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system2.html" class="external-link">system2</a></span><span class="op">(</span><span class="st">"./glm-aed-main/binaries/macos/Sonoma/glm_latest/glm"</span><span class="op">)</span></span></code></pre>
<p>if you are running on Linux you will need to run:</p>
<pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/system2.html" class="external-link">system2</a></span><span class="op">(</span><span class="st">"chmod"</span>,<span class="st">"u+x glm-aed-main/binaries/ubuntu/22.04/glm_latest/glm"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system2.html" class="external-link">system2</a></span><span class="op">(</span><span class="st">"./glm-aed-main/binaries/ubuntu/22.04/glm_latest/glm"</span><span class="op">)</span></span></code></pre>
<p>Working on windows</p>
</div>
<div class="section level2">
<h2 id="use">Use<a class="anchor" aria-label="anchor" href="#use"></a>
</h2>
<p>FLAREr is a set of functions that address key steps in the forecasting workflow.</p>
<div class="section level3">
<h3 id="requires">Requires<a class="anchor" aria-label="anchor" href="#requires"></a>
</h3>
<p>User generated <em>insitu</em> observations, meteorology, and inflow/outflow in a specified format. See FLARE example vignette for format specification. You are required to set a directory structure as follows:</p>
</div>
<div class="section level3">
<h3 id="quick-run">Quick Run<a class="anchor" aria-label="anchor" href="#quick-run"></a>
</h3>
<p>The code below will produce a single forecast for Falling Creek Reservoir using configuration files included with the package.</p>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/apache/arrow/" class="external-link">arrow</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://flare-forecast.org/FLAREr/">FLAREr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"rqthomas/GLM3r"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span><span class="st">'GLM_PATH'</span><span class="op">=</span><span class="st">'GLM3r'</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">lake_directory</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"extdata"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"FLAREr"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/run_flare.html">run_flare</a></span><span class="op">(</span>lake_directory <span class="op">=</span> <span class="va">lake_directory</span>,configure_run_file <span class="op">=</span> <span class="st">"configure_run.yml"</span>, config_set_name <span class="op">=</span> <span class="st">"default"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://arrow.apache.org/docs/r/reference/open_dataset.html" class="external-link">open_dataset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">lake_directory</span>,<span class="st">"forecasts/parquet"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span> <span class="op">==</span> <span class="st">"temperature"</span>,</span>
<span>         <span class="va">depth</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">datetime</span>, y <span class="op">=</span> <span class="va">prediction</span>, group <span class="op">=</span> <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html" class="external-link">as_datetime</a></span><span class="op">(</span><span class="va">reference_datetime</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"1 m water temperature forecast"</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>

  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing FLAREr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>R. Quinn Thomas <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-1282-7825" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/FLARE-forecast/FLAREr/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/FLARE-forecast/FLAREr/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://codecov.io/gh/FLARE-forecast/FLAREr?branch=single-parameter" class="external-link"><img src="https://codecov.io/gh/FLARE-forecast/FLAREr/branch/single-parameter/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by R. Quinn Thomas.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
